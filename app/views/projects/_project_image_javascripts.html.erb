<script type="text/javascript">
  var selectivelyActivateUploadButton = function(){
    $('#new-project-image').change(function(){
      if ($(this).val()) {
        $('#project-image-upload-button').removeClass('disabled');
      } else {
        $('#project-image-upload-button').addClass('disabled');
      }
    });
  };

  var bindImageAdminLinks = function(){
    $('.image-container').on('click', '.set-as-primary', function(){
      var $pushedButton = $(this);
      var imageID = $(this).closest('.image-container').data("image-num");
      $.ajax({
        dataType: 'html',
        url: '/projects/<%= @project.id %>/set-primary-image/' + imageID,
        type: 'post',
        success: function(response){
            $('#primary-image-section').html(response);
            $('.set-as-primary').removeClass('disabled');
            $pushedButton.addClass('disabled');
        }
      });
    });
    $('.image-container').on('click', '.delete-image', function(){
      var $affectedImage = $(this).closest('.image-container');
      var imageID = $affectedImage.data("image-num");
      $.ajax({
        dataType: 'html',
        url: '/projects/<%= @project.id %>/images/' + imageID + '/destroy',
        type: 'post',
        success: function(response){
          $('#primary-image-section').html(response);
          $affectedImage.remove();
          var newPrimaryImageID = $("#primary-image").data("image-num");
          $newBox = $('.image-container[data-image-num=' + newPrimaryImageID + ']')
          $newBox.find('.set-as-primary').addClass('disabled');
          if ($('.image-container').length < 2) {
              $('.delete-image').addClass('disabled');
          }
        }
      });
    });
  };

  var bindRetakeScreenshotButton = function(){
    var $screenshotButton = $("#take-screenshot");
    $screenshotButton.click(function(){
      $screenshotButton.addClass("disabled");
      $.ajax({
        dataType: 'html',
        url: '/projects/<%= @project.id %>/new-screenshot',
        type: 'post',
        success: function(response){
          $('#current-images').html(response);
          $screenshotButton.removeClass("disabled");
          bindImageAdminLinks();
        }
      });
    })
  };

  $(document).ready(function(){
      selectivelyActivateUploadButton();
      bindImageAdminLinks();
      bindRetakeScreenshotButton();
  });
</script>